<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>入社式 受付ページ</title>
</head>
<body>
  <h1>入社式 受付ページ</h1>
  <p id="message">位置情報を確認しています。少々お待ちください。</p>

  <script>
    // === ここを書き換える: 会場の緯度・経度・半径(m) ===
    const TARGET_LAT = 35.656326;     // 例：駒場研修センター付近の緯度
    const TARGET_LON = 139.680968;    // 例：駒場研修センター付近の経度
    const RADIUS_M   = 100;         // 受付を許可する半径（メートル）

    // === ここを書き換える: Microsoft Forms のURL ===
    const FORMS_URL = "https://forms.office.com/Pages/ResponsePage.aspx?id=DUXPH3G7_U6uXZDHvnV-ErBciUpgzMxIuotXr1XJnMhUQ0w2MUtXSFVITzlGQjI2RUpVUFVHMkhIMy4u"; 

    // 距離計算（ハバースインの公式）
    function calcDistance(lat1, lon1, lat2, lon2) {
      const R = 6371000; // 地球半径(m)
      const toRad = deg => deg * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a =
        Math.sin(dLat / 2) ** 2 +
        Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
        Math.sin(dLon / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function showMessage(text) {
      document.getElementById("message").textContent = text;
    }

    // 位置情報取得
    if (!navigator.geolocation) {
      showMessage("この端末では位置情報を取得できません。別の端末をご利用ください。");
    } else {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const dist = calcDistance(lat, lon, TARGET_LAT, TARGET_LON);

          console.log("Your position:", lat, lon, "Distance:", dist);

          if (dist <= RADIUS_M) {
            showMessage("会場範囲内が確認できました。フォームに移動します。");
            // 数秒待ってからFormsへ遷移してもよい
            setTimeout(() => {
              window.location.href = FORMS_URL;
            }, 1000);
          } else {
            showMessage("会場範囲外のため、この場所からはフォームに回答できません。");
          }
        },
        (err) => {
          console.error(err);
          showMessage("位置情報の取得が許可されませんでした。ブラウザの設定をご確認ください。");
        }
      );
    }
  </script>
</body>
</html>
